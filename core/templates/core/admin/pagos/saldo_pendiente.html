<!-- templates/core/admin/pagos/saldo_pendiente.html -->
{% extends "core/base_dashboard.html" %}
{% block title %}Saldo Pendiente{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto bg-gray-800 p-6 rounded shadow">

  <h2 class="text-xl font-bold text-green-400 mb-4">📊 Saldos Pendientes</h2>

  <!-- Formulario de búsqueda -->
  <form method="get" class="mb-6">
    <div class="flex items-center space-x-2">
      <input type="text" name="q" placeholder="Buscar por cliente o factura..." value="{{ request.GET.q }}"
             class="w-full px-4 py-2 rounded bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-400"
             autocomplete="on">
      <button type="submit" class="bg-green-500 text-black font-bold px-4 py-2 rounded hover:bg-green-600">
        🔍 Buscar
      </button>
    </div>
  </form>

  <table class="w-full text-sm bg-zinc-900 border border-zinc-700 rounded">
    <thead class="bg-zinc-800 text-green-300 text-left">
      <tr>
        <th class="p-3">Factura</th>
        <th class="p-3">Cliente</th>
        <th class="p-3">Total</th>
        <th class="p-3">Abonado</th>
        <th class="p-3">Saldo</th>
        <th class="p-3">Último Abono Por</th>
        <th class="p-3">Acción</th>
      </tr>
    </thead>
    <tbody class="text-white">
      {% for venta in ventas %}
      <tr class="border-t border-zinc-700 hover:bg-zinc-800">
        <td class="p-3 font-mono text-blue-400">#{{ venta.id }}</td>
        <td class="p-3">{{ venta.cliente.nombre }}</td>
        <td class="p-3">${{ venta.total }}</td>
        <td class="p-3">${{ venta.calcular_abonos }}</td>
        <td class="p-3 text-yellow-400 font-semibold">${{ venta.calcular_saldo_pendiente }}</td>
        <td class="p-3">
          {% with venta.abonos.last as abono %}
            {{ abono.usuario.username|default:"—" }}
          {% endwith %}
        </td>
        <td class="p-3">
          <a href="{% url 'registrar_abono' %}?venta_id={{ venta.id }}" class="text-green-400 underline font-bold">
            + Abonar
          </a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" class="p-3 text-center text-zinc-400">No hay ventas a crédito con saldo pendiente.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
